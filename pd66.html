<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictor v6.6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* UI v6.6 - Smarter AI & Confidence */
        :root {
            --bg-dark: #1F2040; --bg-card: #2B2D54; --border-color: #4A4E8C;
            --text-primary: #E0E0E0; --text-secondary: #A0A0C0; --accent-blue: #55D6F5;
            --accent-green: #5FFC7B; --accent-red: #FF4D4D; --accent-purple: #C074FF;
            --accent-orange: #FF9500; --accent-yellow: #FFD700;
        }
        .strategy-color-1 { color: #FF6B6B; } .strategy-color-2 { color: #FFD93D; }
        .strategy-color-3 { color: #6BCB77; } .strategy-color-4 { color: #4D96FF; }
        .strategy-color-5 { color: #F07DEA; } .strategy-color-6 { color: #FF9A00; }
        .strategy-color-7 { color: #31E1F7; } .strategy-color-8 { color: #B0E0A3; }
        .strategy-color-0 { color: #E6E6E6; }

        body { 
            font-family: 'Orbitron', sans-serif; background-color: var(--bg-dark);
            color: var(--text-primary); padding: 0.5rem; overflow-x: hidden; 
        }
        .container { width: 100%; max-width: 400px; margin: 0 auto; }
        .header { text-align: center; margin: 0.75rem 0 1.25rem 0; }
        .header h1 { font-weight: 700; color: #FFF; text-shadow: 0 0 5px var(--accent-blue); font-size: 1.75rem;}
        .header p { color: var(--text-secondary); font-size: 0.8rem;}
        
        .card { 
            background-color: var(--bg-card); border: 1px solid var(--border-color); 
            border-radius: 10px; padding: 0.75rem; box-shadow: 0 0 15px rgba(0,0,0,0.3);
        }
        
        .mode-btn { 
            padding: 0.4rem 0.8rem; font-size: 0.8rem; font-weight: 500; border-radius: 6px; 
            border: 1px solid var(--border-color); background: transparent; color: var(--text-secondary); 
            transition: all 0.2s ease; cursor: pointer; 
        }
        .mode-btn.active { 
            background: var(--accent-blue); border-color: var(--accent-blue);
            color: var(--bg-dark); font-weight: 700; box-shadow: 0 0 8px var(--accent-blue); 
        }
        
        .info-line { display: flex; justify-content: space-between; align-items: center; padding: 0.3rem 0; border-bottom: 1px solid var(--border-color);}
        .info-line:last-child { border-bottom: none; }
        .info-label { font-size: 0.75rem; color: var(--text-secondary); display: flex; align-items: center; }
        .info-label svg { width: 0.8rem; height: 0.8rem; margin-right: 0.4rem; color: var(--accent-blue); }
        .info-value { font-size: 0.75rem; font-weight: 500; }

        #prediction-text { font-size: 2rem; font-weight: 700; }
        #insight-text { margin-top: 0.25rem; font-size: 0.75rem; min-height: 1.1rem; font-weight: 700; }
        
        /* Confidence Meter */
        #confidence-level { font-weight: 700; }
        .confidence-high { color: var(--accent-green); }
        .confidence-medium { color: var(--accent-yellow); }
        .confidence-low { color: var(--accent-orange); }

        .progress-bar { width: 100%; height: 5px; background: var(--border-color); border-radius: 3px; overflow: hidden; margin-top: 0.4rem; }
        .progress-fill { height: 100%; background: var(--accent-blue); transition: width 0.2s linear; }

        .table-container { border: 1px solid var(--border-color); border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.35rem; text-align: center; border-bottom: 1px solid var(--border-color); font-size: 0.7rem; }
        th { background: var(--border-color); text-transform: uppercase; font-size: 0.6rem; position: sticky; top: 0; color: var(--text-primary); }
        table tr:last-child td { border-bottom: none; }

        .status-btn { width: 22px; height: 22px; border: none; border-radius: 50%; cursor: pointer; color: white; font-weight: bold; font-size: 0.7rem; display: flex; align-items: center; justify-content: center;}
        .btn-win { background-color: var(--accent-green); }
        .btn-loss { background-color: var(--accent-red); margin-left: 0.4rem; }
        .status-pill { padding: 2px 7px; border-radius: 9999px; font-size: 0.65rem; font-weight: 500; }
        .status-win { background: rgba(95, 252, 123, 0.2); color: var(--accent-green); }
        .status-loss { background: rgba(255, 77, 77, 0.2); color: var(--accent-red); }
        
        .color-red { color: var(--accent-red); } .color-green { color: var(--accent-green); } .color-big { color: var(--accent-orange); } .color-small { color: var(--accent-blue); } .color-number { color: var(--accent-purple); font-weight: 700; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
        .stat-item { background: #1F2040; padding: 0.6rem; border-radius: 8px; text-align: center; }
        .stat-label { font-size: 0.55rem; color: var(--text-secondary); margin-bottom: 0.25rem; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 0.25rem;}
        .stat-value { font-size: 1rem; font-weight: 700; color: var(--accent-blue); }
        .stat-value.win { color: var(--accent-green); } .stat-value.loss { color: var(--accent-red); }
        .stat-value.revenue { color: var(--accent-yellow); }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: var(--bg-card); padding: 1.5rem; border-radius: 8px; text-align: center; max-width: 20rem; width: 90%; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="text-3xl">Predictor <span style="color: var(--accent-blue)">v6.6</span></h1>
            <p>Smart AI Dashboard</p>
        </div>

        <div class="flex flex-col gap-3">
            <div class="card flex justify-around space-x-2">
                <button id="btn30s" class="mode-btn flex-1">30s</button>
                <button id="btn1m" class="mode-btn flex-1">1m</button>
                <button id="btn3m" class="mode-btn flex-1">3m</button>
            </div>
            
            <div class="card">
                <div class="info-line"><span class="info-label"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" /></svg>Period</span><p id="period" class="info-value">Select Mode</p></div>
                <div class="info-line"><span class="info-label"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Timer</span><p id="timer" class="info-value font-bold text-lg" style="color: var(--accent-red);">--:--</p></div>
                <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
            </div>

            <div class="card text-center">
                <div class="flex justify-between items-center text-xs text-secondary mb-2">
                    <p class="info-label"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" /></svg>AI Predict</p>
                    <div class="info-label">Confidence: <span id="confidence-level" class="ml-1">0%</span></div>
                </div>
                <p id="prediction-text">...</p>
                <p id="insight-text"></p>
            </div>

            <div class="card">
                <h2 class="text-base font-semibold mb-2">AI Performance</h2>
                <div class="stat-grid">
                    <div class="stat-item"><div class="stat-label"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>Wins</div><div id="total-wins" class="stat-value win">0</div></div>
                    <div class="stat-item"><div class="stat-label"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>Losses</div><div id="total-losses" class="stat-value loss">0</div></div>
                    <div class="stat-item"><div class="stat-label"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M21.75 12h-2.25m-1.666 5.834L16.5 16.5M4.5 12H2.25m1.666-5.834L5.25 7.5M7.5 15l-2.25 2.25" /></svg>Accuracy</div><div id="accuracy" class="stat-value">0%</div></div>
                    <div class="stat-item"><div class="stat-label"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.75A.75.75 0 013 4.5h.75m0 0H21m-9 12.75h.008v.008H12v-.008z" /></svg>Revenue</div><div id="revenue" class="stat-value revenue">0</div></div>
                </div>
            </div>

            <div class="card">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-base font-semibold">Prediction History</h2>
                    <button id="clear-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded-md text-xs">Clear</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Period</th><th>Num</th><th>Size</th><th>Color</th><th>Status</th></tr></thead>
                        <tbody id="predictions-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="clear-modal" class="modal">
            <div class="modal-content">
                <p class="mb-4">Are you sure you want to clear all data?</p>
                 <div class="flex justify-center gap-4">
                    <button id="confirm-clear" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg">Confirm</button>
                    <button id="cancel-clear" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        const elements = {
            period: document.getElementById('period'), timer: document.getElementById('timer'),
            predictionText: document.getElementById('prediction-text'), insightText: document.getElementById('insight-text'),
            predictionsTable: document.getElementById('predictions-table'),
            progressFill: document.getElementById('progress-fill'),
            clearModal: document.getElementById('clear-modal'),
            totalWins: document.getElementById('total-wins'), totalLosses: document.getElementById('total-losses'),
            accuracy: document.getElementById('accuracy'), revenue: document.getElementById('revenue'),
            confidenceLevel: document.getElementById('confidence-level'),
        };
        let masterInterval; let currentMode = null;
        let lastProcessedSecond = -1;

        const aiTrends = ["Calculation", "Algorithm", "AI Advance Pattern", "Dragon Trend", "Hybrid Feature", "Reverse Trigger", "Single Trend", "Double Trend", "Triple Trend"];
        const initialStateTemplate = () => ({ history: [], predictions: [], currentPeriod: null, lastPredictionLost: false, stats: { totalWins: 0, totalLosses: 0, revenue: 0 } });
        let state = { '30s': initialStateTemplate(), '1m': initialStateTemplate(), '3m': initialStateTemplate() };
        
        const saveState = () => localStorage.setItem('predictorState_v6.6', JSON.stringify(state));
        const loadState = () => {
            const savedState = localStorage.getItem('predictorState_v6.6');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                Object.keys(state).forEach(mode => { if (parsed[mode]) { state[mode] = { ...initialStateTemplate(), ...parsed[mode] }; } });
            }
        };

        const getStrategyColorClass = (strategy) => {
            let hash = 0;
            for (let i = 0; i < strategy.length; i++) { hash += strategy.charCodeAt(i); }
            return `strategy-color-${hash % 9}`;
        };

        const getDuration = () => currentMode === '1m' ? 60 : (currentMode === '3m' ? 180 : 30);

        const generatePeriodNumber = () => {
            if (!currentMode) return "N/A";
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');
            const istTime = new Date(now.getTime() + (330 * 60 * 1000));
            const secondsSinceISTMidnight = (istTime.getUTCHours() * 3600) + (istTime.getUTCMinutes() * 60) + istTime.getUTCSeconds();
            const periodCounter = Math.floor(secondsSinceISTMidnight / getDuration()) + 1;
            return `${dateStr}${String(periodCounter).padStart(5, '0')}`;
        };

        const getRandomNumberForColor = (color) => {
            const numbers = color === 'Red' ? [0, 2, 4, 6, 8] : [1, 3, 5, 7, 9];
            return numbers[Math.floor(Math.random() * numbers.length)];
        };

        const runPredictionEngine = (history) => {
            if (state[currentMode].lastPredictionLost) {
                const lastResult = history[history.length - 1] || { color: 'Green', bigSmall: 'Small' };
                const prediction = { color: lastResult.color === 'Red' ? 'Green' : 'Red', bigSmall: lastResult.bigSmall === 'Big' ? 'Small' : 'Big' };
                return { prediction, strategy: "Loss Recovery", confidence: 75 };
            }

            if (history.length >= 3) {
                const [h1, h2, h3] = history.slice(-3);
                if (h1.color === h2.color && h2.color === h3.color) {
                    return { prediction: { color: h3.color, bigSmall: h3.bigSmall }, strategy: "Triple Trend", confidence: 92 };
                }
                if (h1.color === h3.color && h1.color !== h2.color) {
                    return { prediction: { color: h2.color, bigSmall: h2.bigSmall }, strategy: "Alternating Pattern", confidence: 85 };
                }
            }
            
            if (history.length >= 2) {
                const [h1, h2] = history.slice(-2);
                 if (h1.color === h2.color) {
                    return { prediction: { color: h2.color, bigSmall: h2.bigSmall }, strategy: "Double Trend", confidence: 78 };
                }
            }

            if (history.length > 0) {
                 const last = history[history.length - 1];
                 return { prediction: { color: last.color, bigSmall: last.bigSmall }, strategy: "Single Trend", confidence: 65 };
            }

            return { prediction: { color: 'Green', bigSmall: 'Small'}, strategy: "Data Collection", confidence: 50 };
        };

        const makeNewPrediction = () => {
            if (!currentMode) return;
            const activeState = state[currentMode];
            activeState.currentPeriod = generatePeriodNumber();
            const { prediction, strategy, confidence } = runPredictionEngine(activeState.history);
            prediction.number = getRandomNumberForColor(prediction.color);
            activeState.predictions.push({ period: activeState.currentPeriod, prediction, strategy, confidence, status: 'Pending' });
            if (activeState.predictions.length > 200) activeState.predictions.shift();
            elements.period.textContent = activeState.currentPeriod.slice(-6);
            saveState();
            render();
        };
        
        const masterClock = () => {
            if (!currentMode) return;
            const now = new Date();
            const seconds = now.getSeconds(), minutes = now.getMinutes();
            if (seconds === lastProcessedSecond) return;
            lastProcessedSecond = seconds;
            const duration = getDuration();
            const remainingTime = duration - (((minutes * 60) + seconds) % duration) - 1;
            elements.timer.textContent = `${String(Math.floor(remainingTime / 60)).padStart(2, '0')}:${String(remainingTime % 60).padStart(2, '0')}`;
            elements.progressFill.style.width = `${((duration - remainingTime - 1) / duration) * 100}%`;
            if (remainingTime === duration - 1) makeNewPrediction();
        };
       
        const render = () => {
            if (!currentMode) return;
            const { predictions } = state[currentMode];
            const currentPrediction = predictions[predictions.length - 1];
            if (currentPrediction) {
                elements.predictionText.innerHTML = renderResultInHTML(currentPrediction.prediction);
                elements.insightText.textContent = currentPrediction.strategy;
                elements.insightText.className = `text-xs min-h-[1.1rem] font-semibold ${getStrategyColorClass(currentPrediction.strategy)}`;
                elements.confidenceLevel.textContent = `${currentPrediction.confidence}%`;
                const conf = currentPrediction.confidence;
                elements.confidenceLevel.className = conf >= 85 ? 'confidence-high' : conf >= 70 ? 'confidence-medium' : 'confidence-low';
            }

            elements.predictionsTable.innerHTML = predictions.slice(-10).reverse().map(item => {
                const p = item.prediction;
                const statusHtml = item.status === 'Pending'
                    ? `<div class="flex justify-center items-center"><button class="status-btn btn-win" data-period="${item.period}">W</button><button class="status-btn btn-loss" data-period="${item.period}">L</button></div>`
                    : `<span class="status-pill status-${item.status.toLowerCase()}">${item.status}</span>`;
                return `<tr><td>${String(item.period).slice(-6)}</td><td><strong class="color-number">${p.number}</strong></td><td><strong class="color-${p.bigSmall.toLowerCase()}">${p.bigSmall}</strong></td><td><strong class="color-${p.color.toLowerCase()}">${p.color}</strong></td><td>${statusHtml}</td></tr>`;
            }).join('');
            updatePerformanceStats();
        };

        const updatePerformanceStats = () => {
            const { stats } = state[currentMode];
            const total = stats.totalWins + stats.totalLosses;
            elements.totalWins.textContent = stats.totalWins;
            elements.totalLosses.textContent = stats.totalLosses;
            elements.accuracy.textContent = total > 0 ? `${((stats.totalWins / total) * 100).toFixed(1)}%` : '0%';
            elements.revenue.textContent = stats.revenue;
            elements.revenue.className = `stat-value revenue ${stats.revenue < 0 ? 'negative' : ''}`;
        };
       
        const renderResultInHTML = (result) => {
            if (!result) return '...';
            return `<span class="color-${result.color.toLowerCase()}">${result.color}</span><span class="text-gray-500 mx-2">|</span><span class="color-${result.bigSmall.toLowerCase()}">${result.bigSmall}</span><span class="text-gray-500 mx-2">|</span><span class="color-number">${result.number}</span>`;
        };
        
        const manualSetStatus = (period, status) => {
            if (!currentMode) return;
            const activeState = state[currentMode];
            const prediction = activeState.predictions.find(p => p.period === period);
            if (prediction && prediction.status === 'Pending') {
                prediction.status = status;
                let actualResult;
                if (status === 'Win') {
                    activeState.stats.totalWins++; activeState.stats.revenue++;
                    activeState.lastPredictionLost = false;
                    actualResult = prediction.prediction;
                } else {
                    activeState.stats.totalLosses++; activeState.stats.revenue--;
                    activeState.lastPredictionLost = true;
                    const oppositeColor = prediction.prediction.color === 'Red' ? 'Green' : 'Red';
                    actualResult = { color: oppositeColor, bigSmall: prediction.prediction.bigSmall === 'Big' ? 'Small' : 'Big', number: getRandomNumberForColor(oppositeColor) };
                }
                activeState.history.push({ ...actualResult, period: prediction.period });
                if (activeState.history.length > 50) activeState.history.shift();
                saveState();
                render();
            }
        };

        const selectMode = (mode) => {
            clearInterval(masterInterval);
            currentMode = mode;
            ['30s', '1m', '3m'].forEach(m => document.getElementById(`btn${m}`).classList.toggle('active', mode === m));
            lastProcessedSecond = -1;
            elements.predictionText.innerHTML = '...';
            elements.period.textContent = 'Starting...';
            render();
            makeNewPrediction();
            masterInterval = setInterval(masterClock, 200);
        };

        const resetCurrentMode = () => {
            if (!currentMode) return;
            const modeToReset = currentMode;
            state[modeToReset] = initialStateTemplate();
            saveState();
            selectMode(modeToReset);
        };

        const initApp = () => {
            loadState();
            document.getElementById('confirm-clear').addEventListener('click', () => { resetCurrentMode(); elements.clearModal.style.display = 'none'; });
            document.getElementById('clear-button').addEventListener('click', () => elements.clearModal.style.display = 'flex');
            document.getElementById('cancel-clear').addEventListener('click', () => elements.clearModal.style.display = 'none');
            elements.predictionsTable.addEventListener('click', (event) => {
                const target = event.target.closest('.status-btn');
                if (target) {
                    const status = target.classList.contains('btn-win') ? 'Win' : 'Loss';
                    manualSetStatus(target.dataset.period, status);
                }
            });
            ['30s', '1m', '3m'].forEach(m => {
                document.getElementById(`btn${m}`).addEventListener('click', () => selectMode(m));
            });
            selectMode('30s');
        };

        initApp();
    </script>
</body>
</html>
