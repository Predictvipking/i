<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>55Club Prediction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles for 55Club Lottery theme */
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1A1A2E, #16213E, #0F3460); /* Deep Blue Gradient */
            min-height: 100vh;
            color: #E0E0E0; /* Light Gray text */
            background-size: 300% 300%;
            animation: gradientShift 25s ease infinite alternate;
            display: flex;
            justify-content: center;
            align-items: center; /* Centered by default for login */
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-size: 0.85rem; /* Base font size for compactness */
        }

        /* Adjust body alignment for main app view */
        body.app-active {
            align-items: flex-start;
            padding: 0.4rem 0.2rem; /* Even tighter padding for overall app */
        }

        /* Keyframe Animations */
        @keyframes gradientShift { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        @keyframes fadeIn { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes glow { 0% { filter: drop-shadow(0 0 6px #FFD700); } 50% { filter: drop-shadow(0 0 16px #FFD700); } 100% { filter: drop-shadow(0 0 6px #FFD700); } }
        @keyframes pulse { 0% { transform: scale(0.99); opacity: 0.95; } 50% { transform: scale(1.01); opacity: 1; } 100% { transform: scale(0.99); opacity: 0.95; } }

        /* Container for all content */
        .container {
            max-width: 420px; /* Slightly narrower max-width for very compact feel */
            width: 100%;
            padding: 0;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 0.6rem; /* Very small gap between main elements */
        }
        
        /* Main Application Card */
        .main-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 0.9rem; /* Consistent smaller rounding */
            padding: 0.9rem; /* Reduced overall card padding */
            box-shadow: 0 5px 18px rgba(0, 0, 0, 0.7); /* Refined shadow */
            animation: fadeIn 0.8s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle border */
            position: relative;
            overflow: hidden;
        }
        .main-card:hover {
            transform: translateY(-1px); /* Subtle lift */
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.8);
        }

        /* Login Card - Optimized for centering and compactness */
        .login-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 0.9rem; /* Consistent rounding */
            padding: 1.2rem; /* Compact padding */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.8s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            max-width: 280px; /* Very compact max width */
            text-align: center;
            box-sizing: border-box;
            margin: auto; /* Ensures it's centered within its flex parent (body) */
        }
        .login-card .logo-large {
            width: 55px; /* Smaller logo */
            height: 55px;
            margin: 0 auto 0.5rem; /* Tighter margin */
            display: block;
            animation: glow 2s infinite ease-in-out;
        }
        .login-card h2 {
            font-size: 1.6em; /* More proportional size */
            font-weight: 700;
            color: #FFEA00;
            margin-bottom: 1rem; /* Tighter margin */
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.7);
        }
        .login-card .input-group {
            margin-bottom: 0.6rem; /* Tighter margin */
            text-align: left;
        }
        .login-card label {
            display: block;
            margin-bottom: 0.3rem;
            color: #C0C0C0;
            font-size: 0.8em;
            font-weight: 600;
        }
        .login-card input {
            width: 100%;
            padding: 0.4rem 0.6rem; /* Tighter padding */
            border-radius: 0.5rem; /* Consistent rounding */
            background: rgba(255, 255, 255, 0.1);
            color: #E0E0E0;
            font-size: 0.9em;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease-in-out;
            box-sizing: border-box;
        }
        .login-card input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #FFD700;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.4);
        }
        .login-card button {
            width: 100%;
            padding: 0.6rem; /* Tighter padding */
            border-radius: 0.6rem; /* Consistent rounding */
            background: #FFD700;
            color: #1A1A2E;
            font-size: 1em;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 0.8rem; /* Tighter margin */
        }
        .login-card button:hover {
            background: #FFEA00;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        .login-card #login-error {
            color: #E94560;
            font-size: 0.75em;
            margin-top: 0.6rem; /* Tighter margin */
        }

        /* App Title Section */
        .app-main-title-section {
            background: rgba(0, 0, 0, 0.4);
            padding: 0.4rem 0.6rem;
            border-radius: 0.7rem;
            margin-bottom: 0.8rem; /* Reduced margin */
            box-shadow: inset 0 0 8px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
            position: relative;
        }
        .app-main-title-section .logo-top-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.05rem;
        }
        .app-main-title-section .logo-icon {
            width: 40px;
            height: 40px;
            margin-right: 0.5rem;
            animation: glow 2s infinite ease-in-out;
            flex-shrink: 0;
        }
        .app-main-title-section .logo-text {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(45deg, #FFD700, #FFEA00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        .app-main-title-section .subtitle {
            font-size: 0.75rem;
            color: #C0C0C0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .contact-logout-wrapper {
            position: absolute;
            top: 0.3rem; /* Adjusted position */
            right: 0.3rem; /* Adjusted position */
            z-index: 10;
            display: flex;
            gap: 0.2rem;
        }
        .contact-logout-wrapper button {
            background: none;
            border: none;
            color: #B0B0B0;
            padding: 0.1rem; /* Tighter padding */
            border-radius: 50%;
            font-size: 0.9em; /* Smaller icons */
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .contact-logout-wrapper button:hover {
            color: #FFD700;
            transform: scale(1.1);
        }
        .contact-logout-wrapper button.active {
            color: #FFD700;
            filter: drop-shadow(0 0 3px #FFD700);
        }

        /* Section Titles */
        .section-title {
            font-size: 0.95em; /* Slightly smaller */
            font-weight: 600;
            color: #FFEA00;
            margin-bottom: 0.4rem; /* Reduced margin */
            text-align: center;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 0.3rem;
            margin-top: 0.9rem; /* Reduced margin */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .section-title:first-of-type {
            margin-top: 0;
        }
        .section-title .toggle-icon {
            background: none;
            border: none;
            color: #B0B0B0;
            padding: 0.05rem; /* Very small padding */
            font-size: 0.8em; /* Smaller icon */
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
        }
        .section-title .toggle-icon:hover {
            color: #FFD700;
            transform: translateY(-50%) scale(1.1);
        }

        /* Interval Bar */
        .interval-bar {
            background: rgba(0, 0, 0, 0.4);
            padding: 0.3rem; /* Reduced padding */
            border-radius: 0.5rem;
            margin-bottom: 0.7rem; /* Reduced margin */
            gap: 0.2rem;
            display: flex;
            flex-wrap: nowrap;
            justify-content: space-between;
            box-shadow: inset 0 0 4px rgba(0,0,0,0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .interval-bar::-webkit-scrollbar { display: none; }
        .interval-bar button {
            color: #B0B0B0;
            padding: 0.3rem 0.5rem; /* Reduced padding */
            border-radius: 0.3rem;
            font-size: 0.8em; /* Smaller font */
            font-weight: 600;
            transition: all 0.2s ease;
            flex-shrink: 0;
            flex-grow: 1;
            text-align: center;
            white-space: nowrap;
            box-sizing: border-box;
            border: 1px solid transparent;
            min-width: 24%;
        }
        .interval-bar button.active {
            background: #FFD700;
            box-shadow: 0 0 6px rgba(255, 215, 0, 0.7); /* Reduced shadow */
            color: #1A1A2E;
            font-weight: 700;
            border-color: #FFEA00;
        }
        .interval-bar button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
            color: #E0E0E0;
        }

        /* Input Rows (Bet Limit, Financial Stats) */
        .input-row {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.3rem 0.5rem; /* Reduced padding */
            border-radius: 0.5rem;
            margin-bottom: 0.6rem; /* Reduced margin */
            font-size: 0.8em; /* Smaller font */
            color: #B0B0B0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
            box-shadow: inset 0 0 3px rgba(0,0,0,0.4);
            border: 1px solid rgba(255, 255, 255, 0.08);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .input-row::-webkit-scrollbar { display: none; }

        .input-row div, .input-row span {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 0.1rem;
            white-space: nowrap;
        }
        .input-row span {
            font-weight: 600;
            color: #E0E0E0;
        }
        .input-row input {
            padding: 0.15rem 0.25rem; /* Reduced padding */
            border-radius: 0.25rem; /* Reduced rounding */
            background: rgba(255, 255, 255, 0.1);
            color: #E0E0E0;
            font-size: 0.7em; /* Smaller font */
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease-in-out;
            flex-grow: 1;
            max-width: 50px; /* More constrained input width */
        }
        .input-row input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #FFD700;
            box-shadow: 0 0 0 1.5px rgba(255, 215, 0, 0.4); /* Smaller shadow */
        }

        /* Specific colors for financial stats */
        #bankroll { color: #87CEFA; }
        #level { color: #BA55D3; }
        #nextBet { color: #FFA07A; }
        #profit { color: #3CB371; }
        /* Specific colors for history stats */
        #wins_history { color: #32CD32; }
        #loss_history { color: #FF4500; }
        #accuracy_history { color: #FFD700; }
        #consecutiveLoss_history { color: #FF69B4; }

        /* Predict Section */
        .predict-section { margin-top: 0.9rem; }
        .predict-section label {
            font-weight: 600;
            font-size: 0.85em; /* Smaller font */
            color: #C0C0C0;
            margin-bottom: 0.1rem; /* Reduced margin */
            display: block;
        }
        .predict-section input {
            width: 100%;
            padding: 0.35rem 0.5rem; /* Reduced padding */
            border-radius: 0.4rem;
            background: rgba(255, 255, 255, 0.1);
            color: #E0E0E0;
            font-size: 0.85em; /* Smaller font */
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease-in-out;
            box-sizing: border-box;
        }
        .predict-section input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #FFD700;
            box-shadow: 0 0 0 1.5px rgba(255, 215, 0, 0.4);
        }
        .predict-section .button-group {
            display: flex;
            gap: 0.3rem; /* Reduced gap */
            margin-top: 0.4rem; /* Reduced margin */
        }
        .predict-section button {
            padding: 0.45rem; /* Reduced padding */
            border-radius: 0.4rem;
            font-size: 0.8em; /* Smaller font */
            font-weight: 700;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3); /* Reduced shadow */
            text-transform: uppercase;
            letter-spacing: 0.03em; /* Reduced letter spacing */
            flex: 1;
        }
        .predict-button {
            background: #FFD700;
            color: #1A1A2E;
            border: none;
        }
        .predict-button:hover {
            background: #FFEA00;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
            transform: translateY(-1px);
        }
        .predict-button:disabled {
            background: #3A3A3A;
            color: #707070;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .reset-button {
            background: #E94560;
            color: white;
            border: none;
        }
        .reset-button:hover {
            background: #C73852;
            box-shadow: 0 0 8px rgba(233, 69, 96, 0.8);
            transform: translateY(-1px);
        }

        /* Result Display Area */
        #result {
            padding: 0.5rem; /* Reduced padding */
            background-color: rgba(0,0,0,0.4);
            border-radius: 0.4rem;
            font-size: 0.8em; /* Smaller font */
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.4);
            color: #E0E0E0;
            margin-top: 0.6rem; /* Reduced margin */
        }
        #result strong { font-weight: 700; }
        #result .text-orange-400 { color: #FFA07A; }
        #result .text-blue-400 { color: #87CEFA; }
        #result .text-yellow-400 { color: #FFD700; }
        #result .text-purple-400 { color: #BA55D3; }
        #result .text-green-400 { color: #3CB371; }
        #result .text-red-400 { color: #FF6347; }
        #result .text-xs { font-size: 0.6em; }
        #result .text-gray-400 { color: #A0A0A0; }

        /* AI Generated Result Section */
        .ai-generate-section {
            padding: 0.5rem; /* Reduced padding */
            background-color: rgba(255, 215, 0, 0.1);
            border-radius: 0.4rem;
            border: 1.5px dashed rgba(255, 215, 0, 0.5); /* Thinner dashed border */
            box-shadow: 0 2px 8px rgba(0,0,0,0.4), inset 0 0 8px rgba(255, 215, 0, 0.3);
            animation: pulse 1.5s infinite ease-out alternate;
            margin-top: 0.6rem; /* Reduced margin */
            display: flex;
            align-items: center;
            gap: 0.4rem; /* Reduced gap */
            position: relative;
            min-height: 30px; /* Reduced min-height */
            flex-wrap: wrap; /* Allow wrapping for text at bottom */
            padding-bottom: 1.5em; /* Space for absolute positioned text */
        }
        .ai-generate-section strong {
            font-size: 0.9em; /* Smaller font */
            color: #FFEA00;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.6);
            flex-shrink: 0;
        }
        .ai-generate-section .ai-generated-value {
            font-size: 1.1em; /* Smaller font */
            font-weight: bold;
            color: #FFA07A;
            animation: fadeIn 1s ease-out;
            text-shadow: 0 0 3px rgba(255, 160, 122, 0.5);
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .ai-generate-section p {
            color: #C0C0C0;
            font-size: 0.55em; /* Even smaller font */
            position: absolute; /* Keep text at the bottom */
            bottom: 0.2rem;
            left: 0.5rem;
            right: 0.5rem;
            text-align: center;
            line-height: 1; /* Tighten line height */
        }

        /* History Table */
        .history-table-container {
            max-height: 140px; /* Even further reduced height for history table */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            margin-top: 0.7rem;
            background: rgba(0, 0, 0, 0.2);
        }
        .history-table-container::-webkit-scrollbar { width: 0; background: transparent; }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.65em; /* Smaller table font */
            table-layout: fixed; /* Fix table layout to prevent stretching */
        }
        .history-table th, .history-table td {
            padding: 0.2rem 0.1rem; /* Very tight padding */
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            white-space: nowrap;
            color: #B0B0B0;
            overflow: hidden; /* Hide overflow for content in cells */
            text-overflow: ellipsis; /* Add ellipsis if content overflows */
        }
        .history-table th {
            background: rgba(0, 0, 0, 0.4);
            font-weight: 700;
            color: #E0E0E0;
            position: sticky;
            top: 0;
            z-index: 2;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        .history-table tbody tr:last-child td { border-bottom: none; }
        
        /* Specific column widths to fit content */
        .history-table th:nth-child(1), .history-table td:nth-child(1) { width: 18%; } /* Period */
        .history-table th:nth-child(2), .history-table td:nth-child(2) { width: 8%; }  /* Num */
        .history-table th:nth-child(3), .history-table td:nth-child(3) { width: 10%; } /* Size */
        .history-table th:nth-child(4), .history-table td:nth-child(4) { width: 12%; } /* Color */
        .history-table th:nth-child(5), .history-table td:nth-child(5) { width: 18%; } /* Bet (Lv) */
        .history-table th:nth-child(6), .history-table td:nth-child(6) { width: 15%; } /* Status */
        .history-table th:nth-child(7), .history-table td:nth-child(7) { width: 19%; } /* Action */

        .status-action-cell {
            padding: 0.2rem 0.05rem !important; /* Override default td padding */
        }

        .action-buttons {
            display: flex;
            flex-direction: column; /* Stack Win/Loss vertically */
            justify-content: center;
            align-items: center;
            gap: 0.1rem; /* Small gap between buttons */
            flex-wrap: nowrap;
        }
        .action-buttons button {
            padding: 0.1rem 0.2rem; /* Very small padding */
            border-radius: 0.2rem; /* Very small rounding */
            font-size: 0.6em; /* Extremely small font */
            font-weight: 600;
            min-width: 40px; /* Sufficient width for "Win" / "Loss" text */
            max-width: 100%;
            box-shadow: 0 0px 1px rgba(0,0,0,0.3); /* Minimal shadow */
            box-sizing: border-box;
            line-height: 1; /* Tighten line height */
        }
        .win-button { background: #32CD32; color: #1A1A2E; }
        .loss-button { background: #E94560; color: white; }
        .win-button:hover { background: #2E8B57; }
        .loss-button:hover { background: #C73852; }

        .clear-history-button {
            background: #E94560;
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.8em;
            font-weight: 700;
            margin-top: 1rem;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: none;
            display: none;
        }
        .clear-history-button:hover {
            background: #C73852;
            box-shadow: 0 0 10px rgba(233, 69, 96, 0.8);
            transform: translateY(-1px);
        }

        /* Contact View (outside main card) */
        .contact-view {
            text-align: center;
            padding: 1.2rem 1rem;
            border-radius: 0.8rem;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.15);
            margin-top: 1rem;
        }
        .contact-view h2 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #FFEA00;
            margin-bottom: 0.7rem;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
        .contact-view .divider {
            width: 60%;
            height: 1px;
            background: linear-gradient(to right, transparent, #FFD700, transparent);
            margin: 1rem auto;
        }
        .contact-view p {
            font-size: 0.85rem;
            line-height: 1.4;
            color: #C0C0C0;
            max-width: 95%;
            margin: 0 auto 1rem;
        }
        .contact-view a:hover {
            color: #63B3ED;
            text-decoration: underline;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="login-screen" class="login-card">
            <svg class="logo-large" viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="2">
                <defs>
                    <linearGradient id="logoGradientLogin" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FFEA00;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <circle cx="24" cy="24" r="20" fill="none" stroke="url(#logoGradientLogin)" stroke-width="2"/>
                <path d="M24 12c-6.63 0-12 5.37-12 12s5.37 12 12 12 12-5.37 12-12-5.37-12-12-12zm0 2c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10z" fill="url(#logoGradientLogin)" fill-opacity="0.2"/>
                <path d="M18 20s3-4 6-4 6 4 6 4m-12 8s3 4 6 4 6-4 6-4m-6-16v16" stroke="url(#logoGradientLogin)" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="24" cy="24" r="2" fill="url(#logoGradientLogin)"/>
                <path d="M36 12l-6 6" stroke="url(#logoGradientLogin)" stroke-linecap="round"/>
            </svg>
            <h2>VIP PREDICT AI Login</h2>
            <div class="input-group">
                <label for="username">Username:</label>
                <input type="text" id="username" placeholder="Enter username">
            </div>
            <div class="input-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter password">
            </div>
            <button onclick="login()">Login</button>
            <p id="login-error" class="text-red-400 mt-2 hidden">Invalid username or password.</p>
        </div>

        <div id="main-app-card" class="main-card hidden">
            <div class="app-main-title-section">
                <div class="logo-top-row">
                    <svg class="logo-icon" viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="2">
                        <defs>
                            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FFEA00;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle cx="24" cy="24" r="20" fill="none" stroke="url(#logoGradient)" stroke-width="2"/>
                        <path d="M24 12c-6.63 0-12 5.37-12 12s5.37 12 12 12 12-5.37 12-12-5.37-12-12-12zm0 2c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10z" fill="url(#logoGradient)" fill-opacity="0.2"/>
                        <path d="M18 20s3-4 6-4 6 4 6 4m-12 8s3 4 6 4 6-4 6-4m-6-16v16" stroke="url(#logoGradient)" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="24" cy="24" r="2" fill="url(#logoGradient)"/>
                        <path d="M36 12l-6 6" stroke="url(#logoGradient)" stroke-linecap="round"/>
                    </svg>
                    <h1 class="logo-text">VIP PREDICT AI</h1>
                </div>
                <div class="subtitle">Smart Prediction Tool</div>
                <div class="contact-logout-wrapper">
                    <button id="contact-button" onclick="toggleContactView()" title="Contact Us">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                    </button>
                    <button id="logout-button" onclick="logout()" title="Logout">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="17 16 22 12 17 8"></polyline><line x1="22" y1="12" x2="10" y2="12"></line></svg>
                    </button>
                </div>
            </div>

            <div class="section-title" id="interval-title">Interval Selection</div>
            <div class="interval-bar">
                <button onclick="setIntervalHandler('30')" class="active">30s</button>
                <button onclick="setIntervalHandler('60')">1m</button>
                <button onclick="setIntervalHandler('180')">3m</button>
                <button onclick="setIntervalHandler('300')">5m</button>
            </div>

            <div class="section-title" id="financials-title">
                Financials 
                <button class="toggle-icon" onclick="toggleFinancials()" title="Toggle Financials">
                    <svg id="toggleFinancialsIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </button>
            </div>
            <div id="financials-content">
                <div class="input-row">
                    <span>Initial Bet: <input type="number" id="initialBet" value="2" step="any" min="0.1"></span>
                    <span>Loss Limit: <input type="number" id="lossLimitInput" value="9999" min="1"></span>
                </div>
                <div class="input-row">
                    <div>Bankroll: <span id="bankroll">1000.00</span></div>
                    <div>Level: <span id="level">1</span></div>
                    <div>Next Bet: <span id="nextBet">2.00</span></div>
                    <div>P/L: <span id="profit">0.00</span></div>
                </div>
            </div>

            <div class="section-title">AI Prediction</div>
            <div class="predict-section">
                <label for="fourDigitNumber">Period (last 4 digits):</label>
                <input type="number" id="fourDigitNumber" placeholder="e.g., 2019" oninput="validateFourDigitNumber()">
                <p id="numberStatus" class="text-sm mt-2 h-5"></p>
                <div class="button-group">
                    <button onclick="setFourDigitNumber()" class="predict-button">Set Period</button>
                    <button id="predictButton" onclick="predict()" class="predict-button" disabled>Predict Now</button>
                    <button onclick="resetFourDigitNumber()" class="reset-button">Reset</button>
                </div>
                
                <div id="result" class="mt-4"></div>
                
                <div id="ai-generate-section" class="ai-generate-section hidden mt-4">
                    <strong>AI Result:</strong>
                    <div class="ai-generated-value" id="aiGeneratedOutput"></div>
                    <p class="text-xs text-gray-400">Use this for marking win/loss if you're simulating a game.</p>
                </div>
            </div>
            
            <div class="section-title" id="history-title">
                History & Analysis
                <button class="toggle-icon" onclick="clearHistory()" title="Clear All History">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                </button>
            </div>
            <div class="input-row" id="history-stats-row">
                <div>W: <span id="wins_history">0</span></div>
                <div>L: <span id="loss_history">0</span></div>
                <div>Acc: <span id="accuracy_history">0%</span></div>
                <div>C.Loss: <span id="consecutiveLoss_history">0</span></div>
            </div>
            <div class="history-table-container">
                <table class="history-table">
                    <thead>
                        <tr> <th>Period</th> <th>Num</th> <th>Size</th> <th>Color</th> <th>Bet (Lv)</th> <th>Status</th> <th>Action</th> </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <tr><td colspan="7" style="text-align:center; padding: 10px; color: #a0a0a0;">No history yet.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="contact-view" class="contact-view hidden">
            <h2>Contact Us</h2>
            <div class="divider"></div>
            <p> Email: <a href="mailto:vippredictking@zohomail.in">vippredictking@zohomail.in</a><br> Phone: <a href="tel:+916290530153">+91 6290530153</a> </p>
        </div>
    </div>

    <script>
        // --- Hardcoded User Credentials (FOR DEMO ONLY - NOT SECURE FOR PRODUCTION) ---
        const USERS = {
            "admin": "admin123", // Admin username and password
            "user": "user123"   // Normal user username and password
        };
        const ADMIN_USERNAME = "admin"; // Explicitly define admin username for checks

        // --- Global State ---
        let currentUserRole = null; // Stores 'admin' or 'normal'
        let fourDigitNumber = null;
        let currentDate = getCurrentDateString();
        let selectedInterval = '30';
        let predictionHistory = {};
        let numberWeights = { Big: {}, Small: {} };
        let numberStats = { Big: {}, Small: {} };
        let sizeStats = { Big: { wins: 0, losses: 0 }, Small: { wins: 0, losses: 0 } };
        let recentLossNumbers = { Big: [], Small: [] };
        let recentLossSizes = [];
        let consecutiveLosses = 0;
        let recoveryMode = false;
        let patterns = [];
        let initialBet = 2;
        let lossLimit = 9999;
        let bankroll = 1000;
        let level = 1;
        let nextBet = 2;
        let profit = 0;

        // --- Authentication Functions ---
        function login() {
            const usernameInput = document.getElementById('username').value;
            const passwordInput = document.getElementById('password').value;
            const loginError = document.getElementById('login-error');

            if (USERS[usernameInput] === passwordInput) {
                currentUserRole = (usernameInput === ADMIN_USERNAME) ? 'admin' : 'normal';
                localStorage.setItem('currentUserRole', currentUserRole); // Persist login state
                localStorage.setItem('isLoggedIn', 'true'); // Persist login state
                
                loginError.classList.add('hidden');
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app-card').classList.remove('hidden');
                document.body.classList.add('app-active'); // Add class to body for app view alignment
                applyRoleBasedUI(); // Apply UI changes based on role
                updateUIFromState(); // Refresh main app UI
                console.log(`${currentUserRole} logged in successfully.`);
            } else {
                loginError.textContent = "Invalid username or password.";
                loginError.classList.remove('hidden');
                console.warn("Login failed, user: " + usernameInput);
            }
        }

        function logout() {
            localStorage.removeItem('currentUserRole');
            localStorage.removeItem('isLoggedIn');
            currentUserRole = null;
            document.getElementById('main-app-card').classList.add('hidden');
            document.getElementById('contact-view').classList.add('hidden'); // Hide contact view if active
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-error').classList.add('hidden');
            document.body.classList.remove('app-active'); // Ensure body is centered for login view
            console.log("Logged out.");
        }

        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (isLoggedIn) {
                currentUserRole = localStorage.getItem('currentUserRole');
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app-card').classList.remove('hidden');
                document.body.classList.add('app-active'); // Add class to body for app view alignment
                applyRoleBasedUI();
                updateUIFromState();
                console.log(`User re-logged in as ${currentUserRole}.`);
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app-card').classList.add('hidden');
                document.getElementById('contact-view').classList.add('hidden');
                document.body.classList.remove('app-active'); // Ensure body is centered for login view
                console.log("Not logged in. Showing login screen.");
            }
        }

        function applyRoleBasedUI() {
            const financialsTitle = document.getElementById('financials-title');
            const financialsContent = document.getElementById('financials-content');
            const historyTitle = document.getElementById('history-title');
            const clearHistoryButton = historyTitle.querySelector('.toggle-icon'); // The trash icon for clearing history

            if (currentUserRole === 'normal') {
                // Hide financial sections for normal users
                if (financialsTitle) financialsTitle.classList.add('hidden');
                if (financialsContent) financialsContent.classList.add('hidden');
                
                // Hide clear history button for normal users
                if (clearHistoryButton) clearHistoryButton.classList.add('hidden');

                console.log("UI adjusted for Normal User.");
            } else if (currentUserRole === 'admin') {
                // Show all sections for admin
                if (financialsTitle) financialsTitle.classList.remove('hidden');
                if (financialsContent) financialsContent.classList.remove('hidden');
                if (clearHistoryButton) clearHistoryButton.classList.remove('hidden');
                console.log("UI adjusted for Admin User.");
            }
        }

        // --- Core Prediction Logic Functions (Unchanged from previous version) ---
        function initializePatterns() {
            const defaultPatterns = [
                { name: "Stable Pair BB", pattern: ["Big", "Big"], next: "Big", confidence: 0.7, wins: 0, losses: 0 },
                { name: "Stable Pair SS", pattern: ["Small", "Small"], next: "Small", confidence: 0.7, wins: 0, losses: 0 },
                { name: "Alternating BS", pattern: ["Big", "Small"], next: "Big", confidence: 0.65, wins: 0, losses: 0 },
                { name: "Alternating SB", pattern: ["Small", "Big"], next: "Small", confidence: 0.65, wins: 0, losses: 0 },
                { name: "Triple Big", pattern: ["Big", "Big", "Big"], next: "Big", confidence: 0.8, wins: 0, losses: 0 },
                { name: "Triple Small", pattern: ["Small", "Small", "Small"], next: "Small", confidence: 0.8, wins: 0, losses: 0 },
                { name: "Double Pair BBSS", pattern: ["Big", "Big", "Small", "Small"], next: "Big", confidence: 0.75, wins: 0, losses: 0 },
                { name: "Double Pair SSBB", pattern: ["Small", "Small", "Big", "Big"], next: "Small", confidence: 0.75, wins: 0, losses: 0 },
                { name: "Interrupted Trend BSB", pattern: ["Big", "Small", "Big"], next: "Big", confidence: 0.6, wins: 0, losses: 0 },
                { name: "Interrupted Trend SBS", pattern: ["Small", "Big", "Small"], next: "Small", confidence: 0.6, wins: 0, losses: 0 },
                { name: "Long Run Big", pattern: ["Big", "Big", "Big", "Big"], next: "Big", confidence: 0.85, wins: 0, losses: 0 },
                { name: "Long Run Small", pattern: ["Small", "Small", "Small", "Small"], next: "Small", confidence: 0.85, wins: 0, losses: 0 },
                { name: "Reset After Big Run", pattern: ["Big", "Big", "Big", "Big", "Small"], next: "Big", confidence: 0.7, wins: 0, losses: 0 },
                { name: "Reset After Small Run", pattern: ["Small", "Small", "Small", "Small", "Big"], next: "Small", confidence: 0.7, wins: 0, losses: 0 },
                { name: "Zigzag Four BSSB", pattern: ["Big", "Small", "Small", "Big"], next: "Small", confidence: 0.65, wins: 0, losses: 0 },
                { name: "Zigzag Four SBBSS", pattern: ["Small", "Big", "Big", "Small"], next: "Big", confidence: 0.65, wins: 0, losses: 0 },
                { name: "Recovery Break BSS", pattern: ["Big", "Small", "Small"], next: "Big", confidence: 0.58, wins: 0, losses: 0 },
                { name: "Recovery Break SBB", pattern: ["Small", "Big", "Big"], next: "Small", confidence: 0.58, wins: 0, losses: 0 },
            ];
            try {
                const savedPatternStats = localStorage.getItem('cyberTechVipState_v4_patternStats');
                if (savedPatternStats) {
                    const stats = JSON.parse(savedPatternStats);
                    patterns = defaultPatterns.map(dp => {
                        const savedStat = stats.find(sp => sp.name === dp.name);
                        return { ...dp, wins: savedStat?.wins || 0, losses: savedStat?.losses || 0 };
                    });
                } else {
                    patterns = defaultPatterns;
                }
            } catch (e) {
                console.error("Error loading pattern stats, using defaults:", e);
                patterns = defaultPatterns;
            }
        }

        function initializeStatsAndWeights() {
            ['Big', 'Small'].forEach(size => {
                if (!numberStats[size]) numberStats[size] = {};
                if (!numberWeights[size]) numberWeights[size] = {};
                for (let i = 0; i <= 9; i++) {
                    if (!numberStats[size][i]) numberStats[size][i] = { wins: 0, losses: 0 };
                    if (numberWeights[size][i] === undefined) {
                        numberWeights[size][i] = ((size === 'Big' && [5, 6, 7, 8, 9].includes(i)) || (size === 'Small' && [0, 1, 2, 3, 4].includes(i))) ? 0.15 : 0.05;
                    }
                }
                normalizeWeights(size);
            });
            if (!sizeStats.Big) sizeStats.Big = { wins: 0, losses: 0 };
            if (!sizeStats.Small) sizeStats.Small = { wins: 0, losses: 0 };
        }

        function saveState() {
            const state = {
                predictionHistory, numberWeights, numberStats, sizeStats,
                patterns: patterns.map(p => ({ name: p.name, wins: p.wins, losses: p.losses })),
                selectedInterval, consecutiveLosses, recoveryMode, recentLossNumbers, recentLossSizes,
                initialBet, lossLimit, bankroll, level, nextBet, profit
            };
            try { localStorage.setItem('cyberTechVipState_v4_final', JSON.stringify(state)); }
            catch (e) { console.error("Error saving state:", e); }
        }

        function loadState() {
            try {
                const savedState = localStorage.getItem('cyberTechVipState_v4_final');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    Object.assign(predictionHistory, state.predictionHistory || {});
                    ['30', '60', '180', '300'].forEach(intv => { if (!Array.isArray(predictionHistory[intv])) predictionHistory[intv] = []; });
                    Object.assign(numberWeights, state.numberWeights || { Big: {}, Small: {} });
                    Object.assign(numberStats, state.numberStats || { Big: {}, Small: {} });
                    Object.assign(sizeStats, state.sizeStats || { Big: { wins: 0, losses: 0 }, Small: { wins: 0, losses: 0 } });
                    const savedPatternStats = state.patterns;
                    if (savedPatternStats) { patterns.forEach(p => { const saved = savedPatternStats.find(sp => sp.name === p.name); if (saved) { p.wins = saved.wins || 0; p.losses = saved.losses || 0; } }); }
                    selectedInterval = state.selectedInterval || '30';
                    initialBet = state.initialBet !== undefined ? Math.max(0.1, state.initialBet) : 2;
                    lossLimit = state.lossLimit !== undefined ? state.lossLimit : 9999;
                    bankroll = state.bankroll !== undefined ? state.bankroll : 1000;
                    level = state.level !== undefined ? state.level : 1;
                    profit = state.profit !== undefined ? state.profit : 0;
                    consecutiveLosses = calculateIntervalStreak(selectedInterval);
                    recoveryMode = state.recoveryMode || false;
                    recentLossNumbers = state.recentLossNumbers || { Big: [], Small: [] };
                    recentLossSizes = state.recentLossSizes || [];
                    console.log("State loaded.");
                } else {
                    console.log("No saved state found, using defaults.");
                    clearHistory(false);
                }
            } catch (e) {
                console.error("Error loading state:", e);
                clearHistory(false);
            }
            initializeStatsAndWeights();
            // updateUIFromState() will be called after login check
        }

        function updateUIFromState() {
            document.getElementById('initialBet').value = initialBet.toFixed(2);
            document.getElementById('lossLimitInput').value = lossLimit;
            document.getElementById('bankroll').textContent = bankroll.toFixed(2);
            document.getElementById('level').textContent = level;
            document.getElementById('nextBet').textContent = (initialBet * Math.pow(2, level - 1)).toFixed(2);
            document.getElementById('profit').textContent = profit.toFixed(2);

            document.querySelectorAll('.interval-bar button').forEach(btn => {
                const interval = btn.getAttribute('onclick')?.match(/'(\d+)'/)?.[1];
                btn.classList.toggle('active', interval === selectedInterval);
            });

            updateHistory();
            updateStats();
        }

        function getCurrentDateString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        function checkDateUpdate() {
            const newDate = getCurrentDateString();
            if (newDate !== currentDate) {
                console.log(`Date changed from ${currentDate} to ${newDate}. Clearing daily history.`);
                currentDate = newDate;
            }
        }

        function validateFourDigitNumber() {
            const inputElement = document.getElementById('fourDigitNumber');
            inputElement.value = inputElement.value.replace(/\D/g, '').slice(0, 4);
            const isValid = inputElement.value.length === 4;
            document.getElementById('predictButton').disabled = !isValid;
            document.getElementById('numberStatus').innerHTML = isValid ? '' : '<span class="text-yellow-400 text-xs">Enter 4 digits for period.</span>';
        }

        function setFourDigitNumber() {
            const input = document.getElementById('fourDigitNumber');
            const status = document.getElementById('numberStatus');
            const predictButton = document.getElementById('predictButton');
            const aiGenerateSection = document.getElementById('ai-generate-section');

            if (input.value.length === 4 && !isNaN(input.value)) {
                fourDigitNumber = parseInt(input.value, 10);
                status.innerHTML = `<span class="text-green-400 text-xs">Period ${currentDate}${input.value} set. Click Predict Now.</span>`;
                input.disabled = true;
                predictButton.disabled = false;
                aiGenerateSection.classList.add('hidden');
            } else {
                status.innerHTML = '<span class="text-red-400 text-xs">Invalid period. Enter 4 digits.</span>';
                fourDigitNumber = null;
                predictButton.disabled = true;
                aiGenerateSection.classList.add('hidden');
            }
        }

        function resetFourDigitNumber() {
            fourDigitNumber = null;
            document.getElementById('fourDigitNumber').value = '';
            document.getElementById('fourDigitNumber').disabled = false;
            document.getElementById('numberStatus').innerHTML = '';
            document.getElementById('predictButton').disabled = true;
            document.getElementById('result').innerHTML = '';
            document.getElementById('ai-generate-section').classList.add('hidden');
            console.log("Period input reset.");
        }

        function getFullPeriodNumber() {
            if (fourDigitNumber === null) {
                document.getElementById('numberStatus').innerHTML = '<span class="text-red-400 text-xs">Error: Period number not set.</span>';
                console.error("Attempted to get full period number without setting fourDigitNumber.");
                return null;
            }
            checkDateUpdate();
            return parseInt(currentDate + String(fourDigitNumber).padStart(4, '0'), 10);
        }

        function incrementFourDigitNumber() {
            if (fourDigitNumber === null) return null;
            fourDigitNumber = (fourDigitNumber + 1) % 10000;
            document.getElementById('fourDigitNumber').value = String(fourDigitNumber).padStart(4, '0');
            document.getElementById('fourDigitNumber').disabled = true;
            document.getElementById('predictButton').disabled = true;
            document.getElementById('numberStatus').innerHTML = '';
            document.getElementById('result').innerHTML = '';
            document.getElementById('ai-generate-section').classList.add('hidden');
            console.log(`Auto-incremented fourDigitNumber to: ${fourDigitNumber}`);
            return fourDigitNumber;
        }

        function simulateAIResult() {
            const resultNumber = Math.floor(Math.random() * 10);
            let resultColor, resultSize;
            if (resultNumber === 0 || resultNumber === 5) resultColor = 'Violet';
            else if ([1, 3, 7, 9].includes(resultNumber)) resultColor = 'Green';
            else resultColor = 'Red';
            resultSize = (resultNumber >= 0 && resultNumber <= 4) ? 'Small' : 'Big';

            const resultDiv = document.getElementById('aiGeneratedOutput');
            const aiGenerateSection = document.getElementById('ai-generate-section');
            if (resultDiv && aiGenerateSection) {
                const numberColor = (resultNumber === 0 || resultNumber === 5) ? 'text-purple-400' : ([1, 3, 7, 9].includes(resultNumber) ? 'text-green-400' : 'text-red-400');
                const sizeColor = resultSize === 'Big' ? 'text-blue-400' : 'text-yellow-400';
                resultDiv.innerHTML = `<span class="${numberColor}">${resultNumber}</span> | <span class="${sizeColor}">${resultSize}</span> | <span class="${numberColor}">${resultColor}</span>`;
                aiGenerateSection.classList.remove('hidden');
            }
            return { number: resultNumber, color: resultColor, size: resultSize };
        }

        function matchPattern(history) {
            const relevantHistory = history.filter(p => p.status !== 'Pending' && p.size);
            const maxPatternLength = Math.max(...patterns.map(p => p.pattern.length));
            if (relevantHistory.length < maxPatternLength) return null;

            let bestMatch = null;
            let highestConfidence = -1;

            for (let i = 0; i < patterns.length; i++) {
                const pattern = patterns[i];
                if (relevantHistory.length >= pattern.pattern.length) {
                    const historySlice = relevantHistory.slice(-pattern.pattern.length).map(p => p.size);
                    if (historySlice.join(',') === pattern.pattern.join(',')) {
                        const total = pattern.wins + pattern.losses;
                        const successRate = total > 0 ? pattern.wins / total : 0.5;
                        const adjustedConfidence = (pattern.confidence * 0.7) + (successRate * 0.3);
                        if (adjustedConfidence > highestConfidence) {
                            highestConfidence = adjustedConfidence;
                            bestMatch = pattern;
                        }
                    }
                }
            }
            return bestMatch ? { next: bestMatch.next, confidence: highestConfidence, patternName: bestMatch.name } : null;
        }

        function getSizeWinRate(size) {
            const stats = sizeStats[size];
            const total = stats ? stats.wins + stats.losses : 0;
            return total > 0 ? stats.wins / total : 0.5;
        }

        function getNumberWinRate(size, number) {
            const stats = numberStats[size]?.[number];
            const total = stats ? stats.wins + stats.losses : 0;
            return total > 0 ? stats.wins / total : 0.5;
        }

        function selectBestSize(history) {
            const completedHistory = history.filter(p => p.status !== 'Pending' && p.size);
            if (recoveryMode && recentLossSizes.length > 0) {
                const mostRecentLossSize = recentLossSizes[0];
                return mostRecentLossSize === 'Big' ? 'Small' : 'Big';
            }
            if (completedHistory.length >= 2) {
                const lastTwo = completedHistory.slice(-2).map(p => p.size);
                if (lastTwo[0] === lastTwo[1]) return lastTwo[0];
                else return lastTwo[0] === 'Big' ? 'Small' : 'Big';
            }
            const bigWinRate = getSizeWinRate('Big');
            const smallWinRate = getSizeWinRate('Small');
            return bigWinRate > smallWinRate ? 'Big' : 'Small';
        }

        function selectWeightedNumber(size, excludedNumbers = []) {
            const weights = numberWeights[size];
            if (!weights) return Math.floor(Math.random() * 10);

            const availableNumbers = Object.keys(weights)
                .map(Number)
                .filter(num => !excludedNumbers.includes(num));

            if (availableNumbers.length === 0) {
                const allNumbers = [0,1,2,3,4,5,6,7,8,9];
                const fallbackNumbers = allNumbers.filter(num => !excludedNumbers.includes(num));
                return fallbackNumbers.length > 0 ? fallbackNumbers[Math.floor(Math.random() * fallbackNumbers.length)] : Math.floor(Math.random() * 10);
            }

            const combinedScores = availableNumbers.map(num => {
                const weight = weights[num] || 0.01;
                const winRate = getNumberWinRate(size, num);
                return { num, score: (weight * 0.3) + (winRate * 0.7) };
            });
            const sortedScores = combinedScores.sort((a, b) => b.score - a.score);
            const topN = Math.min(3, sortedScores.length);
            const selectedIndex = Math.floor(Math.random() * topN);
            return sortedScores[selectedIndex].num;
        }

        function getBalancedNumber(size, previousNumbers = []) {
            const excluded = [...previousNumbers, ...(recentLossNumbers[size] || [])];
            return selectWeightedNumber(size, excluded);
        }

        function getConfidenceScore(patternConfidence = 0.5, predictedSize) {
            const sizeWinRate = getSizeWinRate(predictedSize);
            const totalHistoryForSize = sizeStats[predictedSize].wins + sizeStats[predictedSize].losses;
            let combinedConfidence = (patternConfidence * 0.6) + (sizeWinRate * 0.3);
            const historyBonus = Math.min(0.1, totalHistoryForSize / 1000);
            combinedConfidence += historyBonus;
            const scaledConfidence = 40 + (combinedConfidence * 59);
            return Math.min(99, Math.max(40, Math.floor(scaledConfidence)));
        }

        function adjustBet(currentLevelStatus) {
            let currentLvl = currentLevelStatus.level;
            let currentConsecLoss = currentLevelStatus.consecutiveLosses;
            let nextLevel = currentLvl;
            const initialBetVal = parseFloat(document.getElementById('initialBet').value) || initialBet;
            const maxLevel = 8;

            if (currentLevelStatus.status === 'Loss') {
                nextLevel = currentLvl + 1;
                if (nextLevel > maxLevel) {
                    console.warn(`Max level ${maxLevel} reached. Resetting level and entering recovery mode.`);
                    nextLevel = 1;
                    recoveryMode = true;
                }
            } else if (currentLevelStatus.status === 'Win') {
                nextLevel = 1;
                recoveryMode = false;
            }

            let nextBetAmount = initialBetVal * Math.pow(2, nextLevel - 1);
            const currentLossLimit = parseFloat(document.getElementById('lossLimitInput').value) || lossLimit;

            if (nextBetAmount > currentLossLimit) {
                console.warn(`Next bet (${nextBetAmount.toFixed(2)}) exceeds loss limit (${currentLossLimit}). Resetting level and entering recovery mode.`);
                nextLevel = 1;
                nextBetAmount = initialBetVal;
                recoveryMode = true;
            }

            if (currentConsecLoss >= 3 && currentLevelStatus.status === 'Loss') {
                console.log("Entering recovery mode due to 3+ consecutive losses.");
                recoveryMode = true;
            }
            return { bet: nextBetAmount, level: nextLevel };
        }

        function predict(isAuto = false) {
            // Check if financial content is hidden for normal users (this logic is still good)
            if (currentUserRole === 'normal' && document.getElementById('financials-content').classList.contains('hidden')) {
                // You might want to disable the 'Predict Now' button or show a message for normal users
                // if their betting capabilities are tied to financial display. For now, it proceeds.
            }

            let periodToPredict = isAuto ? getFullPeriodNumber() : getFullPeriodNumber();
            if (periodToPredict === null) return;

            if (!predictionHistory[selectedInterval]) predictionHistory[selectedInterval] = [];
            const history = predictionHistory[selectedInterval];

            if (history.some(p => p.period === periodToPredict)) {
                document.getElementById('numberStatus').innerHTML = `<span class="text-yellow-400 text-xs">Period ${periodToPredict} already predicted/marked.</span>`;
                return;
            }

            let predictedSize;
            let patternConfidence = 0.5;
            let matchedPatternName = "Fallback/Default";

            const patternMatch = matchPattern(history);

            if (recoveryMode || consecutiveLosses >= 2) {
                predictedSize = selectBestSize(history);
                if (recentLossSizes.length > 0) {
                    predictedSize = recentLossSizes[0] === 'Big' ? 'Small' : 'Big';
                    console.log(`Aggressive Recovery: Switching from recent loss size (${recentLossSizes[0]}) to ${predictedSize}`);
                }
                patternConfidence = 0.6;
                matchedPatternName = "Recovery Mode";
                console.log(`Recovery Mode Active (Losses: ${consecutiveLosses}). Predicting: ${predictedSize}`);
            } else if (patternMatch) {
                predictedSize = patternMatch.next;
                patternConfidence = patternMatch.confidence;
                matchedPatternName = patternMatch.patternName;
                console.log(`Pattern Matched: ${matchedPatternName}. Predicting: ${predictedSize} with pattern confidence: ${patternConfidence.toFixed(2)}`);
            } else {
                predictedSize = selectBestSize(history);
                patternConfidence = Math.max(0.3, (getSizeWinRate(predictedSize) * 0.5));
                matchedPatternName = `Fallback (Trend-based)`;
                console.log(`No strong pattern matched. Fallback prediction: ${predictedSize}`);
            }

            const recentNumbersForExclusion = history.slice(0, 3).map(pred => pred.number1);
            const predictedNumber = getBalancedNumber(predictedSize, recentNumbersForExclusion);
            const predictedColor = (predictedNumber === 0 || predictedNumber === 5) ? 'Violet' : ([1, 3, 7, 9].includes(predictedNumber) ? 'Green' : 'Red');
            const displayConfidence = getConfidenceScore(patternConfidence, predictedSize);

            document.getElementById('result').innerHTML = `<div>Prediction: <strong class="text-orange-400">${predictedNumber}</strong> (${predictedColor}) | Size: <strong class="${predictedSize === 'Big' ? 'text-blue-400' : 'text-yellow-400'}">${predictedSize}</strong> | Confidence: ${displayConfidence}%</div><div class="text-xs text-gray-400">Based on: ${matchedPatternName}</div>`;

            // Bet logic only applies if user is admin. Normal users' bets aren't tracked financially.
            const currentBetAmount = (currentUserRole === 'admin') ? 
                                    (parseFloat(document.getElementById('nextBet').textContent) || initialBet) : initialBet;
            const currentLvl = (currentUserRole === 'admin') ?
                               (parseInt(document.getElementById('level').textContent) || 1) : 1;

            const prediction = {
                period: periodToPredict, number1: predictedNumber, color1: predictedColor, size: predictedSize,
                confidence: displayConfidence, pattern: matchedPatternName, status: 'Pending', bet: currentBetAmount, level: currentLvl
            };

            predictionHistory[selectedInterval].unshift(prediction);
            if (predictionHistory[selectedInterval].length > 50) predictionHistory[selectedInterval].pop();

            updateHistory();
            updateStats();

            if (!isAuto) {
                document.getElementById('predictButton').disabled = true;
                document.getElementById('numberStatus').innerHTML = '<span class="text-blue-400 text-xs">Prediction added. Mark Win/Loss in history.</span>';
            } else {
                document.getElementById('numberStatus').innerHTML = `<span class="text-blue-400 text-xs">Auto-predicted for ${periodToPredict}. Mark result.</span>`;
                document.getElementById('fourDigitNumber').disabled = true;
            }
            saveState();
            simulateAIResult();
        }

        function markWin(index) {
            const history = predictionHistory[selectedInterval];
            if (history && history[index] && history[index].status === 'Pending') {
                history[index].status = 'Win';
                const { size, number1, pattern, bet, level: predictionLevel } = history[index];

                // Only update financial stats if user is admin
                if (currentUserRole === 'admin') {
                    bankroll += bet;
                    profit += bet;
                }

                // Always update prediction stats (number/size/pattern wins/losses) regardless of role
                if (size && numberStats[size]?.[number1]) numberStats[size][number1].wins++;
                if (size && sizeStats[size]) sizeStats[size].wins++;
                const patternIndex = patterns.findIndex(p => p.name === pattern);
                if (patternIndex !== -1) patterns[patternIndex].wins++;
                if (size && numberWeights[size]?.[number1] !== undefined) {
                    numberWeights[size][number1] = Math.min(1, (numberWeights[size][number1] || 0.1) * 1.2);
                    normalizeWeights(size);
                }

                consecutiveLosses = 0;
                recoveryMode = false;
                
                const { bet: nextBetAmount, level: nextLevel } = adjustBet({ level: predictionLevel, consecutiveLosses: 0, status: 'Win' });
                level = nextLevel;
                nextBet = nextBetAmount;

                recentLossNumbers = { Big: [], Small: [] };
                recentLossSizes = [];

                updateUIFromState();
                saveState();

                const nextPeriodNum = incrementFourDigitNumber();
                if (nextPeriodNum !== null) predict(true);
            }
        }

        function markLoss(index) {
            const history = predictionHistory[selectedInterval];
            if (history && history[index] && history[index].status === 'Pending') {
                history[index].status = 'Lost';
                const { size, number1, pattern, bet, level: predictionLevel } = history[index];

                // Only update financial stats if user is admin
                if (currentUserRole === 'admin') {
                    bankroll -= bet;
                    profit -= bet;
                }

                // Always update prediction stats (number/size/pattern wins/losses) regardless of role
                if (size && numberStats[size]?.[number1]) numberStats[size][number1].losses++;
                if (size && sizeStats[size]) sizeStats[size].losses++;
                const patternIndex = patterns.findIndex(p => p.name === pattern);
                if (patternIndex !== -1) patterns[patternIndex].losses++;
                if (size && numberWeights[size]?.[number1] !== undefined) {
                    numberWeights[size][number1] = Math.max(0.01, (numberWeights[size][number1] || 0.1) * 0.8);
                    normalizeWeights(size);
                }

                if (size && recentLossNumbers[size]) {
                    recentLossNumbers[size].unshift(number1);
                    if (recentLossNumbers[size].length > 3) recentLossNumbers[size].pop();
                }
                if (size) {
                    recentLossSizes.unshift(size);
                    if (recentLossSizes.length > 3) recentLossSizes.pop();
                }

                consecutiveLosses++;
                
                const { bet: nextBetAmount, level: nextLevel } = adjustBet({ level: predictionLevel, consecutiveLosses: consecutiveLosses, status: 'Loss' });
                level = nextLevel;
                nextBet = nextBetAmount;

                updateUIFromState();
                saveState();

                const nextPeriodNum = incrementFourDigitNumber();
                if (nextPeriodNum !== null) predict(true);
            }
        }

        function normalizeWeights(size) {
            const currentWeights = numberWeights[size];
            if (!currentWeights) return;

            const relevantNumbers = Object.keys(currentWeights).filter(num => {
                const n = parseInt(num, 10);
                return (size === 'Big' && n >= 5 && n <= 9) || (size === 'Small' && n >= 0 && n <= 4);
            });

            if (relevantNumbers.length === 0 || relevantNumbers.every(num => (currentWeights[num] || 0) <= 0.01)) {
                for (let num of Object.keys(currentWeights)) {
                    currentWeights[num] = ((size === 'Big' && parseInt(num, 10) >= 5) || (size === 'Small' && parseInt(num, 10) <= 4)) ? 0.15 : 0.05;
                }
            }

            const totalWeight = Object.values(currentWeights).reduce((sum, w) => sum + (w || 0), 0);
            if (totalWeight > 0) {
                for (let num in currentWeights) {
                    currentWeights[num] = (currentWeights[num] || 0) / totalWeight;
                }
            } else {
                for (let num in currentWeights) {
                    currentWeights[num] = 0.1;
                }
            }
        }

        function updateHistory() {
            const historyTableBody = document.getElementById('historyTableBody');
            const currentHistory = predictionHistory[selectedInterval] || [];
            const sortedHistory = [...currentHistory].sort((a, b) => b.period - a.period);

            historyTableBody.innerHTML = sortedHistory.map((pred, index) => {
                const originalIndex = currentHistory.findIndex(h => h.period === pred.period);
                let statusColor = 'gray';
                if (pred.status === 'Win') statusColor = '#32CD32';
                else if (pred.status === 'Lost') statusColor = '#FF4500';

                // Only show action buttons if user is admin
                const actionButtons = (pred.status === 'Pending' && currentUserRole === 'admin') ?
                    `<div class="action-buttons">
                        <button class="win-button" onclick="markWin(${originalIndex})">Win</button>
                        <button class="loss-button" onclick="markLoss(${originalIndex})">Loss</button>
                    </div>` : '';

                return `<tr>
                            <td>${pred.period || '-'}</td>
                            <td>${pred.number1 !== undefined ? pred.number1 : '-'}</td>
                            <td>${pred.size || '-'}</td>
                            <td>${pred.color1 || '-'}</td>
                            <td>${pred.bet !== undefined ? pred.bet.toFixed(2) : '-'} (Lv${pred.level !== undefined ? pred.level : '-'})</td>
                            <td style="color: ${statusColor}; font-weight: bold;">${pred.status || 'Pending'}</td>
                            <td class="status-action-cell">${actionButtons}</td>
                        </tr>`;
            }).join('');

            if (currentHistory.length === 0) {
                historyTableBody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding: 10px; color: #A0AEC0;">No history for this interval.</td></tr>`;
            }
        }

        function updateStats() {
            const history = predictionHistory[selectedInterval] || [];
            const wins = history.filter(pred => pred.status === 'Win').length;
            const losses = history.filter(pred => pred.status === 'Lost').length;
            const total = wins + losses;
            const accuracy = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;

            // Only update financial stats if user is admin
            if (currentUserRole === 'admin') {
                document.getElementById('bankroll').textContent = bankroll.toFixed(2);
                document.getElementById('level').textContent = level;
                document.getElementById('nextBet').textContent = nextBet.toFixed(2);
                document.getElementById('profit').textContent = profit.toFixed(2);
            } else {
                 // For normal users, financial stats might show default or empty values if not tracked
                 document.getElementById('bankroll').textContent = "N/A";
                 document.getElementById('level').textContent = "N/A";
                 document.getElementById('nextBet').textContent = "N/A";
                 document.getElementById('profit').textContent = "N/A";
            }
            

            // Update stats in the History & Analysis section (visible to all roles)
            document.getElementById('wins_history').textContent = wins;
            document.getElementById('loss_history').textContent = losses;
            document.getElementById('accuracy_history').textContent = `${accuracy}%`;
            document.getElementById('consecutiveLoss_history').textContent = consecutiveLosses;
        }

        function calculateIntervalStreak(interval) {
            const history = predictionHistory[interval] || [];
            let streak = 0;
            for (let i = 0; i < history.length; i++) {
                if (history[i].status === 'Lost') streak++;
                else if (history[i].status === 'Win') {
                    break;
                } else {
                    break;
                }
            }
            return streak;
        }

        function clearHistory(confirmUser = true) {
            // Only allow admin to clear history
            if (currentUserRole !== 'admin') {
                alert("You do not have permission to clear history.");
                return;
            }

            if (confirmUser && !confirm(`Clear all history and stats for ${selectedInterval}s interval? This cannot be undone!`)) {
                return;
            }

            console.log(`Clearing history for interval: ${selectedInterval}s`);
            if (predictionHistory[selectedInterval]) {
                predictionHistory[selectedInterval] = [];
            }

            consecutiveLosses = 0;
            recoveryMode = false;
            recentLossNumbers = { Big: [], Small: [] };
            recentLossSizes = [];

            patterns.forEach(p => { p.wins = 0; p.losses = 0; });
            initializeStatsAndWeights();

            level = 1;
            nextBet = initialBet;
            profit = 0;
            bankroll = 1000;

            updateUIFromState();
            saveState();
            console.log("History and stats cleared for interval.");
        }

        function toggleContactView() {
            const contactView = document.getElementById('contact-view');
            const mainAppCard = document.getElementById('main-app-card');
            const contactButton = document.getElementById('contact-button');

            if (contactView.classList.contains('hidden')) {
                contactView.classList.remove('hidden');
                mainAppCard.classList.add('hidden');
                if(contactButton) contactButton.classList.add('active');
                // When showing contact view, we still want to align top, not center
                document.body.classList.add('app-active');
                console.log("Showing Contact Us view.");
            } else {
                contactView.classList.add('hidden');
                mainAppCard.classList.remove('hidden');
                if(contactButton) contactButton.classList.remove('active');
                document.body.classList.add('app-active'); // Ensure body is top-aligned for main app
                console.log("Showing main application view.");
                updateUIFromState();
            }
        }

        function toggleFinancials() {
            // Only allow admin to toggle financials
            if (currentUserRole !== 'admin') {
                alert("You do not have permission to toggle financials.");
                return;
            }

            const financialsContent = document.getElementById('financials-content');
            const toggleIcon = document.getElementById('toggleFinancialsIcon');
            financialsContent.classList.toggle('hidden');
            if (financialsContent.classList.contains('hidden')) {
                toggleIcon.innerHTML = `<polyline points="18 15 12 9 6 15"></polyline>`; // Down arrow
                toggleIcon.title = "Show Financials";
            } else {
                toggleIcon.innerHTML = `<polyline points="6 9 12 15 18 9"></polyline>`; // Up arrow
                toggleIcon.title = "Hide Financials";
            }
        }

        function setIntervalHandler(interval) {
            if (selectedInterval === interval) return;
            selectedInterval = interval;
            consecutiveLosses = calculateIntervalStreak(selectedInterval);
            updateUIFromState();
            saveState();
            console.log(`Switched to interval: ${selectedInterval}`);
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializePatterns();
            loadState(); // Load global state first
            checkLoginStatus(); // Then check login status and display appropriate screen
            
            // Event listeners for financial inputs (always attach, but UI will hide for normal users)
            document.getElementById('initialBet').addEventListener('change', (e) => {
                if (currentUserRole === 'admin') { // Only admin can change these values
                    initialBet = parseFloat(e.target.value) || 2;
                    if (initialBet < 0.1) initialBet = 0.1;
                    e.target.value = initialBet.toFixed(2);
                    level = 1; // Reset level on initial bet change
                    nextBet = initialBet;
                    consecutiveLosses = 0; // Reset consecutive losses
                    profit = 0; // Reset profit
                    updateUIFromState();
                    saveState();
                } else {
                    e.target.value = initialBet.toFixed(2); // Revert value if not allowed
                    alert("Only admin can change Initial Bet.");
                }
            });

            document.getElementById('lossLimitInput').addEventListener('change', (e) => {
                if (currentUserRole === 'admin') { // Only admin can change these values
                    lossLimit = parseInt(e.target.value) || 9999;
                    if (lossLimit < 1) lossLimit = 1;
                    e.target.value = lossLimit;
                    saveState();
                } else {
                    e.target.value = lossLimit; // Revert value if not allowed
                    alert("Only admin can change Loss Limit.");
                }
            });

            // Initial UI setup will be handled by checkLoginStatus and applyRoleBasedUI
        });

        window.addEventListener('beforeunload', saveState);
    </script>
</body>
</html>
